<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlackWall | Threat Intelligence | (OSINT)</title>

<style>
body {
  margin: 0;
  font-family: 'Courier New', monospace;
  background: #000;
  color: #0ff;
  overflow-x: hidden;
}

canvas#matrix {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  pointer-events: none;
}

.container {
  max-width: 1200px;
  margin: 20px auto;
  padding: 10px;
  position: relative;
  z-index: 1;
}

h1 {
  color: #0ff;
  text-align: center;
  font-size: 2em;
  text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
}

#search-container {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

#search-box {
  flex: 1;
  padding: 10px;
  font-size: 1em;
  background: #111;
  border: 1px solid #0ff;
  color: #0ff;
}

#clear-search, #search-submit, #last-24h, #archive {
  background:#0ff;
  color:#060;
  border:none;
  padding:5px 10px;
  cursor:pointer;
  font-weight:bold;
  border-radius:3px;
}

#feed-note {
  color: #6f6;
  font-size: 0.9em;
  margin-bottom: 10px;
  text-align: center;
}

#search-status, #archive-note {
  text-align:center;
  color:#f66;
  font-weight:bold;
  margin-bottom:10px;
  display:none;
}

.button-bar {
  display:flex;
  justify-content:flex-end;
  margin-bottom:10px;
  gap:10px;
}

button {
  background:#0ff;
  color:#060;
  border:none;
  padding:5px 10px;
  cursor:pointer;
  font-weight:bold;
  border-radius:3px;
}

.feed-panel {
  margin-bottom: 20px;
  border: 1px solid #0ff;
  border-radius: 5px;
  overflow: hidden;
  background: rgba(0,0,0,0.7);
  box-shadow: 0 0 10px #0ff;
}

.feed-header {
  padding: 10px;
  background: #000;
  cursor: pointer;
  font-weight: bold;
  font-size: 1.2em;
  text-shadow: 0 0 5px #0ff;
}

.feed-entries {
  display: none;
  padding: 10px;
  max-height: 500px;
  overflow-y: auto;
}

.entry-card {
  background: rgba(0,0,0,0.8);
  border: 1px solid #0ff;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 5px;
  transition: 0.3s;
}

.entry-card:hover {
  box-shadow: 0 0 10px #0ff;
  transform: scale(1.02);
}

.entry-title {
  font-size: 1.1em;
  font-weight: bold;
  color: #0ff;
  text-decoration: none;
}

.heading {
  color: #6f6;
  font-weight: bold;
  margin-top: 6px;
}

.value {
  color: #afa;
  margin-left: 5px;
}

mark.highlight {
  background-color: #0ff; 
  color: #000;
}

::selection {
  background: #0ff; 
  color: #000;
}

.feed-entries::-webkit-scrollbar {
  width: 8px;
}
.feed-entries::-webkit-scrollbar-thumb {
  background: #0ff;
  border-radius: 4px;
}
</style>
</head>
<body>

<canvas id="matrix"></canvas>

<div class="container">
  <h1>BlackWall | Threat Intelligence | (OSINT)</h1>

  <div class="button-bar">
    <button id="last-24h">Last 24 Hours</button>
    <button id="archive">Archive</button>
    <input type="text" id="search-box" placeholder="Search feeds...">
    <button id="search-submit">Search</button>
    <button id="clear-search">Clear</button>
  </div>

  <div id="feed-note">Titles can be clicked to view the source</div>
  <div id="archive-note"></div>
  <div id="search-status">No matches found</div>
  <div id="feeds-container"></div>
</div>

<script>
/* ==== MATRIX ==== */
const canvas = document.getElementById('matrix');
const ctx = canvas.getContext('2d');
let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;
const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()*&^%'.split('');
const fontSize = 18;
const columns = Math.floor(width / fontSize);
const drops = Array(columns).fill(0);

function drawMatrix() {
  ctx.fillStyle = 'rgba(0,0,0,0.05)';
  ctx.fillRect(0,0,width,height);
  ctx.fillStyle = '#0ff';
  ctx.font = fontSize + 'px monospace';
  for (let i=0;i<drops.length;i++){
    const text = letters[Math.floor(Math.random()*letters.length)];
    ctx.fillText(text, i*fontSize, drops[i]*fontSize);
    if (drops[i]*fontSize > height && Math.random() > 0.975) drops[i]=0;
    drops[i]++;
  }
}
setInterval(drawMatrix,50);
window.addEventListener('resize',()=>{width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight;});

/* ==== FEEDS & ARCHIVES ==== */
const feeds = {
  "Bleeping Computer": "bleeping.json",
  "The Hacker News": "hackernews.json",
  "CISA Advisories": "cisa.json",
  "Mandiant Reports": "mandiant.json",
  "Ransomware Live": "ransomware_live.json",
  "MITRE ATT&CK Actors": "mitre.json"
};

// Example archive files
const archives = {
  "bleeping": ["archive/bleeping_20260217.json","archive/bleeping_20260216.json"],
  "hackernews": ["archive/hackernews_20260217.json","archive/hackernews_20260216.json"]
};

const container = document.getElementById('feeds-container');
const searchBox = document.getElementById('search-box');
const archiveNote = document.getElementById('archive-note');

/* ==== HELPER ==== */
function addField(card, label, value) {
  if (!value) return;
  const heading = document.createElement('div');
  heading.className = 'heading';
  heading.textContent = label;
  card.appendChild(heading);

  const val = document.createElement('div');
  val.className = 'value';
  val.textContent = value;
  card.appendChild(val);
}

function removeHighlights(element) {
  element.querySelectorAll('mark.highlight').forEach(mark => {
    const parent = mark.parentNode;
    parent.replaceChild(document.createTextNode(mark.textContent), mark);
    parent.normalize();
  });
}

function highlightText(element, query) {
  if (!query) return;
  const regex = new RegExp(`(${query.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');
  const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);
  let node;
  while ((node = walker.nextNode())) {
    if (node.nodeValue.toLowerCase().includes(query.toLowerCase())) {
      const frag = document.createDocumentFragment();
      let lastIndex = 0;
      node.nodeValue.replace(regex, (match) => {
        const idx = node.nodeValue.toLowerCase().indexOf(match.toLowerCase(), lastIndex);
        if (idx > lastIndex) frag.appendChild(document.createTextNode(node.nodeValue.slice(lastIndex, idx)));
        const mark = document.createElement('mark');
        mark.className = 'highlight';
        mark.textContent = match;
        frag.appendChild(mark);
        lastIndex = idx + match.length;
        return match;
      });
      frag.appendChild(document.createTextNode(node.nodeValue.slice(lastIndex)));
      node.parentNode.replaceChild(frag, node);
    }
  }
}

/* ==== FEED LOADING ==== */
async function loadFeed(file, feedName) {
  try {
    const res = await fetch(file);
    const data = await res.json();

    const panel = document.createElement('div');
    panel.className = 'feed-panel';
    const header = document.createElement('div');
    header.className = 'feed-header';
    header.textContent = `${feedName} (${data.length})`;
    panel.appendChild(header);

    const entriesDiv = document.createElement('div');
    entriesDiv.className = 'feed-entries';
    header.onclick = () => {
      entriesDiv.style.display = entriesDiv.style.display === 'block' ? 'none' : 'block';
    };

    data.forEach(entry => {
      const card = document.createElement('div');
      card.className = 'entry-card';

      const title = document.createElement('a');
      title.className = 'entry-title';
      title.href = entry.link || entry.mitre_url || '#';
      title.target = '_blank';
      title.textContent = entry.title || entry.actor_name || 'No title';
      card.appendChild(title);

      const pub = entry.published || entry.last_updated;
      if (pub) addField(card, "Published (UTC):", new Date(pub).toISOString().replace('T',' ').split('.')[0] + "Z");

      let summary = entry.summary || entry.description;
      if (summary) summary = summary.replace(/\.\.\.$/, '');
      if (summary) addField(card, "Summary:", summary);

      if (entry.aliases) addField(card, "Aliases:", entry.aliases);
      if (entry.techniques) addField(card, "Techniques:", entry.techniques);
      if (entry.attribution) addField(card, "Attribution:", entry.attribution);
      if (entry.country) addField(card, "Country:", entry.country);
      if (entry.website) addField(card, "Website:", entry.website);

      entriesDiv.appendChild(card);
    });

    panel.appendChild(entriesDiv);
    container.appendChild(panel);
  } catch(e) {
    console.error(`Error loading ${file}`, e);
    archiveNote.style.display = 'block';
    archiveNote.textContent = 'Timeframe error';
  }
}

/* ==== INIT FEEDS ==== */
document.getElementById('last-24h').addEventListener('click', async () => {
  container.innerHTML = '';
  archiveNote.style.display = 'none';
  for (const [name, file] of Object.entries(feeds)) {
    if (name === "MITRE ATT&CK Actors") {
      await loadFeed(file, name); // only latest MITRE
    } else {
      await loadFeed(file, name);
    }
  }
});

document.getElementById('archive').addEventListener('click', async () => {
  container.innerHTML = '';
  archiveNote.style.display = 'block';
  archiveNote.textContent = 'Only one archive can be accessed at a time';
  // load first archive file for each feed as example
  for (const [feedKey, files] of Object.entries(archives)) {
    if (files.length > 0) {
      await loadFeed(files[0], feedKey.charAt(0).toUpperCase() + feedKey.slice(1) + " Archive");
    }
  }
});

/* ==== SEARCH ==== */
document.getElementById('search-submit').addEventListener('click', async () => {
  const query = searchBox.value.trim().toLowerCase();
  if (!query) return;
  container.innerHTML = '';
  archiveNote.style.display = 'none';
  let anyMatch = false;

  async function searchFiles(feedFile, feedName) {
    try {
      const res = await fetch(feedFile);
      const data = await res.json();
      data.forEach(entry => {
        const text = (entry.title || entry.actor_name || '') + ' ' +
                     (entry.summary || entry.description || '') + ' ' +
                     (entry.aliases || '') + ' ' +
                     (entry.techniques || '') + ' ' +
                     (entry.attribution || '');
        if (text.toLowerCase().includes(query)) {
          anyMatch = true;
          loadFeed(feedFile, feedName);
        }
      });
    } catch {
      archiveNote.style.display = 'block';
      archiveNote.textContent = 'Timeframe error';
    }
  }

  for (const [name, file] of Object.entries(feeds)) await searchFiles(file, name);
  for (const [feedKey, files] of Object.entries(archives)) {
    for (const f of files) await searchFiles(f, feedKey + " Archive");
  }

  document.getElementById('search-status').style.display = !anyMatch ? 'block' : 'none';
});

/* ==== CLEAR SEARCH BUTTON ==== */
document.getElementById('clear-search').addEventListener('click', () => {
  searchBox.value = '';
  container.innerHTML = '';
  archiveNote.style.display = 'none';
});

/* ==== EXPAND / COLLAPSE ALL ==== */
document.getElementById('expand-all').addEventListener('click', () => {
  document.querySelectorAll('.feed-entries').forEach(div => div.style.display = 'block');
});
document.getElementById('collapse-all').addEventListener('click', () => {
  document.querySelectorAll('.feed-entries').forEach(div => div.style.display = 'none');
});
</script>
</body>
</html>

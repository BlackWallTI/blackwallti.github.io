<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlackWall | Threat Intelligence | (OSINT)</title>

<style>
body {
  margin: 0;
  font-family: 'Courier New', monospace;
  background: #000;
  color: #0ff;
  overflow-x: hidden;
}

canvas#matrix {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  pointer-events: none;
}

.container {
  max-width: 1200px;
  margin: 20px auto;
  padding: 10px;
  position: relative;
  z-index: 1;
}

h1 {
  color: #0ff;
  text-align: center;
  font-size: 2em;
  text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
}

#search-box {
  width: 100%;
  padding: 10px;
  font-size: 1em;
  margin-bottom: 10px;
  background: #111;
  border: 1px solid #0ff;
  color: #0ff;
}

#feed-note {
  color: #6f6;
  font-size: 0.9em;
  margin-bottom: 15px;
  text-align: center;
}

#search-status {
  text-align:center;
  color:#f66;
  font-weight:bold;
  margin-bottom:10px;
  display:none;
}

.button-bar {
  display:flex;
  justify-content:flex-end;
  margin-bottom:10px;
  gap:10px;
}

button {
  background:#0ff;
  color:#060;
  border:none;
  padding:5px 10px;
  cursor:pointer;
  font-weight:bold;
  border-radius:3px;
}

/* FEED PANELS */
.feed-panel {
  margin-bottom: 20px;
  border: 1px solid #0ff;
  border-radius: 5px;
  overflow: hidden;
  background: rgba(0,0,0,0.7);
  box-shadow: 0 0 10px #0ff;
}

.feed-header {
  padding: 10px;
  background: #000;
  cursor: pointer;
  font-weight: bold;
  font-size: 1.2em;
  text-shadow: 0 0 5px #0ff;
}

.feed-entries {
  display: none;
  padding: 10px;
  max-height: 500px;
  overflow-y: auto;
}

.entry-card {
  background: rgba(0,0,0,0.8);
  border: 1px solid #0ff;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 5px;
  transition: 0.3s;
}

.entry-card:hover {
  box-shadow: 0 0 10px #0ff;
  transform: scale(1.02);
}

.entry-title {
  font-size: 1.1em;
  font-weight: bold;
  color: #0ff;
  text-decoration: none;
}

.heading {
  color: #6f6;
  font-weight: bold;
  margin-top: 6px;
}

.value {
  color: #afa;
  margin-left: 5px;
}

.feed-entries::-webkit-scrollbar {
  width: 8px;
}
.feed-entries::-webkit-scrollbar-thumb {
  background: #0ff;
  border-radius: 4px;
}

/* HIGHLIGHT SEARCH TERM */
mark.highlight {
  background-color: rgba(0, 255, 255, 0.5); /* light cyan/blue */
  color: #000;
  padding: 0 2px;
  border-radius: 2px;
}

/* HIGHLIGHT WHEN SELECTING TEXT */
::selection {
  background-color: rgba(0, 255, 255, 0.5);
  color: #000;
}
</style>
</head>
<body>

<canvas id="matrix"></canvas>

<div class="container">
  <h1>BlackWall | Threat Intelligence | (OSINT)</h1>
  <input type="text" id="search-box" placeholder="Search feeds...">
  <div id="feed-note">Titles can be clicked to view the source</div>
  <div class="button-bar">
    <button id="expand-all">Expand All</button>
    <button id="collapse-all">Collapse All</button>
  </div>
  <div id="search-status">No matches found</div>
  <div id="feeds-container"></div>
</div>

<script>
/* ==== MATRIX ==== */
const canvas = document.getElementById('matrix');
const ctx = canvas.getContext('2d');
let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;
const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()*&^%'.split('');
const fontSize = 18;
const columns = Math.floor(width / fontSize);
const drops = Array(columns).fill(0);

function drawMatrix() {
  ctx.fillStyle = 'rgba(0,0,0,0.05)';
  ctx.fillRect(0,0,width,height);
  ctx.fillStyle = '#0ff';
  ctx.font = fontSize + 'px monospace';
  for (let i=0;i<drops.length;i++){
    const text = letters[Math.floor(Math.random()*letters.length)];
    ctx.fillText(text, i*fontSize, drops[i]*fontSize);
    if (drops[i]*fontSize > height && Math.random() > 0.975) drops[i]=0;
    drops[i]++;
  }
}
setInterval(drawMatrix,50);
window.addEventListener('resize',()=>{width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight;} );

/* ==== FEEDS ==== */
const feeds = {
  "Bleeping Computer": "bleeping.json",
  "The Hacker News": "hackernews.json",
  "CISA Advisories": "cisa.json",
  "Mandiant Reports": "mandiant.json",
  "Ransomware Live": "ransomware_live.json",
  "MITRE ATT&CK Actors": "mitre.json"
};

const container = document.getElementById('feeds-container');
const searchBox = document.getElementById('search-box');

function addField(card, label, value) {
  if (!value) return;
  const heading = document.createElement('div');
  heading.className = 'heading';
  heading.textContent = label;
  card.appendChild(heading);

  const val = document.createElement('div');
  val.className = 'value';
  val.textContent = value;
  card.appendChild(val);
}

/* ==== LOAD FEEDS ==== */
async function loadFeeds() {
  for (const [feedName, feedFile] of Object.entries(feeds)) {
    try {
      const res = await fetch(feedFile);
      const data = await res.json();

      const panel = document.createElement('div');
      panel.className = 'feed-panel';

      const header = document.createElement('div');
      header.className = 'feed-header';
      header.textContent = `${feedName} (${data.length})`;
      panel.appendChild(header);

      const entriesDiv = document.createElement('div');
      entriesDiv.className = 'feed-entries';
      header.onclick = () => {
        entriesDiv.style.display =
          entriesDiv.style.display === 'block' ? 'none' : 'block';
      };

      data.forEach(entry => {
        const card = document.createElement('div');
        card.className = 'entry-card';

        /* Title */
        const title = document.createElement('a');
        title.className = 'entry-title';
        title.href = entry.link || entry.mitre_url || '#';
        title.target = '_blank';
        title.textContent = entry.title || entry.actor_name || 'No title';
        card.appendChild(title);

        /* Published */
        const pub = entry.published || entry.last_updated;
        if (pub) {
          const iso = new Date(pub).toISOString().replace('T',' ').split('.')[0] + "Z";
          addField(card, "Published (UTC):", iso);
        }

        /* Summary */
        let summary = entry.summary || entry.description;
        if (summary) {
          summary = summary.replace(/\.\.\.$/, '');
          addField(card, "Summary:", summary);
        }

        if (entry.aliases) addField(card, "Aliases:", entry.aliases);
        if (entry.techniques) addField(card, "Techniques:", entry.techniques);
        if (entry.attribution) addField(card, "Attribution:", entry.attribution);
        if (entry.country) addField(card, "Country:", entry.country);
        if (entry.website) addField(card, "Website:", entry.website);

        entriesDiv.appendChild(card);
      });

      panel.appendChild(entriesDiv);
      container.appendChild(panel);

    } catch (err) {
      console.error(`Failed to load ${feedFile}`, err);
    }
  }
}

/* ==== SEARCH + HIGHLIGHT + AUTO-EXPAND + NO MATCHES ==== */
searchBox.addEventListener('input', () => {
  const query = searchBox.value.trim().toLowerCase();
  let anyMatch = false;

  document.querySelectorAll('.feed-panel').forEach(panel => {
    const entriesDiv = panel.querySelector('.feed-entries');
    let panelHasMatch = false;

    entriesDiv.querySelectorAll('.entry-card').forEach(card => {
      // Reset previous highlights
      card.querySelectorAll('mark.highlight').forEach(mark => {
        mark.replaceWith(document.createTextNode(mark.textContent));
      });

      const cardText = card.textContent.toLowerCase();
      const isMatch = cardText.includes(query);

      // Highlight term in text nodes
      if (isMatch && query) {
        card.querySelectorAll('*').forEach(node => {
          if (node.childNodes && node.childNodes.length > 0) {
            node.childNodes.forEach(child => {
              if (child.nodeType === 3) { // text node
                const regex = new RegExp(`(${query})`, 'gi');
                const span = document.createElement('span');
                span.innerHTML = child.textContent.replace(regex, '<mark class="highlight">$1</mark>');
                child.replaceWith(span);
              }
            });
          }
        });
      }

      card.style.display = isMatch ? 'block' : 'none';
      if (isMatch) panelHasMatch = true;
    });

    // Expand panel if matches found
    entriesDiv.style.display = panelHasMatch ? 'block' : (query === '' ? 'none' : 'none');
    if (panelHasMatch) anyMatch = true;
  });

  document.getElementById('search-status').style.display = query && !anyMatch ? 'block' : 'none';
});

/* ==== EXPAND / COLLAPSE ALL BUTTONS ==== */
document.getElementById('expand-all').addEventListener('click', () => {
  document.querySelectorAll('.feed-entries').forEach(div => div.style.display = 'block');
});
document.getElementById('collapse-all').addEventListener('click', () => {
  document.querySelectorAll('.feed-entries').forEach(div => div.style.display = 'none');
});

/* ==== INIT ==== */
loadFeeds();
</script>
</body>
</html>
